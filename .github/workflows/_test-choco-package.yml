name: üç´ CI - Test Choco Package

on:
  workflow_call:
    inputs:
      pkgname:
        description: Name of the package
        required: true
        type: string
  workflow_dispatch:
    inputs:
      pkgname:
        description: Name of the package
        required: true
        type: choice
        options:
          - '7tt'
          - 'action'
          - 'betterdiscord'
          - 'blitz.gg'
          - 'borderlessminecraft'
          - 'croc'
          - 'dcforoffice'
          - 'jarfix'
          - 'leagueoflegendseune'
          - 'nvm.install'
          - 'nvm.portable'
          - 'onefetch'
          - 'portmaster'
          - 'tcno-acc-switcher'
          - 'tree-sitter'
          - 'windhawk'
          - 'valorant'

jobs:
  test-choco-packages:
    runs-on: windows-2019
    steps:
      - name: Checkout
        uses: actions/checkout@v2.3.4
      - name: üîß Build package
        run: |
          .\build.ps1 ${{ github.event.inputs.pkgname }}
      - name: ‚ûï Add New Package Source
        uses: crazy-max/ghaction-chocolatey@v1
        with:
          args: source add --name='repo' --source='./dist/' --priority='1'
      - name: üü¢ Install ${{ github.event.inputs.pkgname }}
        uses: crazy-max/ghaction-chocolatey@v1
        timeout-minutes: 3
        continue-on-error: true
        with:
          args: install${{ github.event.inputs.pkgname }} -dvy
      - name: üî¥ Uninstall ${{ github.event.inputs.pkgname }}
        uses: crazy-max/ghaction-chocolatey@v1
        continue-on-error: false
        with:
          args: uninstall ${{ github.event.inputs.pkgname }} -dvy
